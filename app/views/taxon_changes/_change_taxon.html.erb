<%- photo ||= change_taxon.photos.first -%>
<%- taxon_range ||= change_taxon.taxon_ranges.first -%>
<%- rendered_taxon_name = capture do -%>
  <%= render(:partial => 'shared/taxon.html.erb', :object => change_taxon) -%>
<%- end -%>

<div id="change_taxon_<%= change_taxon.id %>" class="change_taxon clear <%= change_taxon.iconic_taxon.name rescue 'Unknown' %> taxon-<%= change_taxon.id %>">
  
  <div class="column image">
    <%- if photo -%>
      <%= modal_image(photo) %>
    <% else -%>
      <%= link_to '', change_taxon %>
    <% end -%>
  </div>
  
  <div class="column details">
    <%= link_to rendered_taxon_name, change_taxon %>
    <div class="description">
      <%= link_to change_taxon.observations_count, observations_path(:taxon_id => change_taxon.id) %> Obs
      <%= "|#{change_taxon.conservation_status_code}" unless change_taxon.conservation_status.nil? %>
      <%= "|Range" if taxon_range %>
    </div>
    <div class="description">
      <span class="small description"> (<%= change_taxon.is_active ? "active" : "inactive" %>)
        <% if change_taxon.source && change_taxon.source_url %>
          Source: <%= link_to h(truncate(change_taxon.source.title, :length => 40)), change_taxon.source_url %>
        <% elsif change_taxon.source %>
          Source: <%= change_taxon.source.title %>
        <% elsif change_taxon.creator %>
          Added by <%= link_to h(change_taxon.creator.login), change_taxon.creator %>
        <% else %>
          Source: unknown
        <% end %>
      </span>
    </div>
  </div>
</div>