iNatAPI.factory( "ObservationsFactory", [ "shared", function( shared ) {
  var show = function( id ) {
    var url = "<%= CONFIG.tile_servers.elasticsearch %>/observations/" + id;
    return shared.basicGet( url );
  };
  var search = function( params ) {
    var url = "<%= CONFIG.tile_servers.elasticsearch %>/observations";
    params.per_page = 12;
    if( params ) { url += "?" + $.param(params); }
    return shared.basicGet( url );
  };
  var stats = function( params ) {
    var url = "<%= CONFIG.tile_servers.elasticsearch %>/observations/stats";
    if( params ) { url += "?" + $.param(params); }
    return shared.basicGet( url );
  };
  var speciesCounts = function( params ) {
    var url = "<%= CONFIG.tile_servers.elasticsearch %>/observations/species_counts";
    if( params ) { url += "?" + $.param(params); }
    return shared.basicGet( url );
  };
  var identifiers = function( params ) {
    var url = "<%= CONFIG.tile_servers.elasticsearch %>/observations/identifiers";
    if( params ) { url += "?" + $.param(params); }
    return shared.basicGet( url );
  };
  var observers = function( params ) {
    var url = "<%= CONFIG.tile_servers.elasticsearch %>/observations/observers";
    if( params ) { url += "?" + $.param(params); }
    return shared.basicGet( url );
  };
  var responseToInstances = function( response ) {
    if( !( response && response.data && response.data.results ) ) {
      return { };
    }
    return _.map( response.data.results, function( r ) {
      return new iNatModels.Observation( r );
    });
  };
  return {
    show: show,
    search: search,
    stats: stats,
    speciesCounts: speciesCounts,
    identifiers: identifiers,
    observers: observers,
    responseToInstances: responseToInstances
  };
}]);
