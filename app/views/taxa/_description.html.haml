:ruby
  if @describer.blank? && !@taxon.wikipedia_summary.blank? && !@taxon.wikipedia_summary.match(/^\d\d\d\d-\d\d-\d\d$/)
    @description ||= "<p>#{@taxon.wikipedia_summary}</p>".html_safe
  end
  css_class = "clear taxon_description"
  if @describer
    css_class += " #{@describer.name.split('::').last.underscore}_description"
    if @describer.is_a?( TaxonDescribers::Wikipedia ) || @describer.ancestors.include?( TaxonDescribers::Wikipedia )
      css_class += " wikipedia_description"
    end
  end
#taxon_description{:class => css_class}
  %h3.taxon_description_header
    =t :description_from
    - if @describer
      = select_tag :from, options_for_select(@describers.sort_by(&:name).map{|d| [d.describer_name, d.name.split('::').last]}, :selected => @describer.name.split('::').last)
      - if page_url = @describer.page_url(@taxon)
        = link_to "#{t(:view_on)} #{@describer.describer_name} &rarr;".html_safe, page_url, :class => "externallink ui"
    - else
      %a{ href: @describer_url } Wikipedia
  - if @description.blank?
    %p.nocontent.meta
      - if @describer == TaxonDescribers::Wikipedia || @describer.blank?
        - if @taxon.auto_description?
          =t :there_isnt_a_wikipedia_article_titled_x_html, :x => @taxon.name
        - else
          =t "views.taxa.show.site_curators_disabled_wikipedia_html", url: @describer_url
      - elsif @describer
        =t :no_matching_article_from_x, :x => @describer.describer_name
  - else
    =raw @description
  - if params[:wiki_prompt] && I18n.locale.to_s =~ /^en/ && ( @description.blank? || @describer == TaxonDescribers::Inaturalist )
    %hr
    .alert.alert-warning.upstacked
      %p
        Help the world out and
        = link_to "create this page on Wikipedia!", "https://#{I18n.locale.to_s.split( "-" )[0]}.wikipedia.org/w/index.php?title=#{@taxon.name}&action=edit"
      %p Here's a template to get you started:
      :ruby
        stub = if @taxon.iconic_taxon
          "#{Taxon::ICONIC_TAXON_NAMES[@taxon.iconic_taxon_name].split( " " ).last.singularize}-stub"
        else
          "biology-stub"
        end
        translated_rank = if @taxon.rank.blank?
          I18n.t( :rank, default: "rank" ).downcase
        else
          I18n.t( "ranks.#{@taxon.rank}", default: @taxon.rank ).downcase
        end
        image = nil
        if taxon_photo = @taxon.taxon_photos.sort_by{|tp| tp.position || tp.id}.detect{|tp| tp.photo.is_a?( WikimediaCommonsPhoto ) }
          image = taxon_photo.photo.native_photo_id
        end
        structure = <<-WIKI
          #{I18n.t(:taxon_is_a_rank, taxon: @taxon.name, rank: translated_rank )}.
          ==Description==
        WIKI
        if @taxon.species?
          structure += <<-WIKI
            ==Range==
            ==Habitat==
            ==Ecology==
          WIKI
        end
        structure += <<-WIKI
          ==Etymology==
          ==Taxonomy==
          ==References==
        {{Reflist}}
        WIKI
        box = <<-WIKI
          {{automatic taxobox
          | taxon = #{@taxon.name}
          | rank = #{@taxon.rank}
          | parent = #{@taxon.parent ? ( @taxon.parent.wikipedia_title.blank? ? @taxon.parent.name : @taxon.parent.wikipedia_title ) : "" }
          }}
        WIKI
        if @taxon.species?
          box = <<-WIKI
            {{Speciesbox
            | parent = #{@taxon.genus.name}
            #{"| image = #{image}" if image}
            }}
          WIKI
        elsif @taxon.rank == Taxon::SUBSPECIES && Taxon::ICONIC_TAXA_BY_NAME["Animalia"] && @taxon.self_and_ancestor_ids.include?( Taxon::ICONIC_TAXA_BY_NAME["Animalia"].id )
          box = <<-WIKI
            {{Subspeciesbox
            | genus = #{@taxon.genus.name}
            | species =  #{@taxon.species.name.split( " " ).last}
            | subspecies = #{@taxon.name.split( " " ).last}
            }}
          WIKI
        elsif @taxon.rank == Taxon::HYBRID
          box = <<-WIKI
            {{Hybridbox
            | name = #{@taxon.name}
            | genus =  #{@taxon.genus.name}
            }}
          WIKI
        elsif @taxon.rank == Taxon::SUBSPECIES && Taxon::ICONIC_TAXA_BY_NAME["Plantae"] && @taxon.self_and_ancestor_ids.include?( Taxon::ICONIC_TAXA_BY_NAME["Plantae"].id )
          box = <<-WIKI
            {{Infraspeciesbox
            | genus = #{@taxon.genus.name}
            | species =  #{@taxon.species.name.split( " " ).last}
            | subspecies = #{@taxon.name.split( " " ).last}
            }}
          WIKI
        elsif @taxon.rank == Taxon::VARIETY && Taxon::ICONIC_TAXA_BY_NAME["Plantae"] && @taxon.self_and_ancestor_ids.include?( Taxon::ICONIC_TAXA_BY_NAME["Plantae"].id )
          box = <<-WIKI
            {{Infraspeciesbox
            | genus = #{@taxon.genus.name}
            | species =  #{@taxon.species.name.split( " " ).last}
            | varietas = #{@taxon.name.split( " " ).last}
            }}
          WIKI
        end
        wikitext = <<-WIKI
          #{box}
          #{structure}
          {{#{stub}}}
        WIKI
      %pre.code
        = wikitext.gsub( /^\s+/, "" )

      %ul
        %li
          Learn more about
          %a{ href: "https://en.wikipedia.org/wiki/Template:Speciesbox" }
            Speciesbox
        %li
          Learn more about
          %a{ href: "https://en.wikipedia.org/wiki/Template:Subspeciesbox" }
            Subspeciesbox
        %li
          Learn more about
          %a{ href: "https://en.wikipedia.org/wiki/Template:Infraspeciesbox" }
            Infraspeciesbox
        %li
          Learn more about
          %a{ href: "https://en.wikipedia.org/wiki/Template:Hybridbox" }
            Hybridbox
        %li
          Learn more about
          %a{ href: "https://en.wikipedia.org/wiki/Template:Automatic_taxobox" }
            Automatic taxobox
        %li
          Learn more about
          %a{ href: "https://en.wikipedia.org/wiki/Wikipedia:WikiProject_Stub_sorting/Stub_types#Biological_sciences" }
            stubs
        %li
          Remember to
          %strong cite your sources!


