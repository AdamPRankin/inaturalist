<%-
  observations = if @update_cache && @update_cache[:observations]
    updates.map{|u| @update_cache[:observations][u.notifier_id]}
  end.compact
  observations = updates.map{|u| u.notifier}.compact if observations.blank?
  
  update = updates.last
  resource = if @update_cache && @update_cache[update.resource_type.underscore.pluralize.to_sym]
    @update_cache[update.resource_type.underscore.pluralize.to_sym][update.resource_id]
  end
  resource ||= update.resource
  login = resource.login
  
  target_id = rand(36**8).to_s(36)
-%>

<div class="timeline-body">
  <%= render partial: 'observations/observations_component_for_dashboard', locals: {observations: observations[0...12], target_id: target_id} %>
</div>
<%- if observations.count > 1 %>
  <div class="timeline-footer">
    <%= link_to t(:view_observations), observations_path({user_id: login, subview: "grid"}), class: "btn btn-sm btn-primary" %>
    <% if observations.count > 4 -%>
      <button type="button" class="btn btn-sm btn-default btn_expand collapsed pull-right" data-toggle="collapse" data-target="<%="#expand#{target_id}" %>" aria-pressed="false" autocomplete="off">
        <span class="expand_inactive"><i class="glyphicon glyphicon-collapse-down"></i> Show More...</span>
        <span class="expand_active"><i class="glyphicon glyphicon-collapse-up"></i> Show Less</span>
      </button>
    <% end -%>    
  </div>
<% end %>
