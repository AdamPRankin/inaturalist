- content_for :extrajs do
  = javascript_include_tag "angular_bundle"
  = javascript_include_tag "ang/controllers/observation_search"
- content_for :extracss do
  = stylesheet_link_tag "observations/search_prototype"
  = stylesheet_link_tag "angular-google-places-autocomplete/src/autocomplete"

#main-container{ "ng-app": "ObservationSearch", "ng-controller": "SearchController" }
  .row.form
    .col-xs-12
      #filters
        %h1= t :observations
        #filter-container.btn-group.pull-right
          %button.btn.btn-default.dropdown-toggle
            Filters
            %span.caret
          .dropdown-menu.dropdown-menu-right{"ng-include": "'ang/templates/observation_search/filter_menu.html'", onload: "setupFilters()"}
        .form-inline.pull-right.primary-filters
          %input.form-control{ placeholder: "Taxon", type: "search", name: "taxon_name" }
          %input{ type: "hidden", name: "taxon_id" }
          in
          / ng-model-options="{debounce: 1000}" means angular will wait 1000 ms after the last change in the UI before changing the bound model value
          / g-places-autocomplete triggers the Google place autocomplete directive
          %input.form-control{ name: "place_name", "ng-model-options": "{debounce: 1000}", placeholder: "Place name", type: "text", "g-places-autocomplete": "", "ng-model": "place" }
  #stats-container
    .col-xs-4
      %span.geo{ "ng-class": "{ active: params.geoType=='world' }", "ng-click": "setGeoFilter('world')"}
        The World
      %span.geo{ "ng-class": "{ active: params.geoType=='map' }", "ng-click": "setGeoFilter('visible')"}
        Visible Map
    .col-xs-2.green
      .stat-title= "Observations"
      .stat-value.ng-cloak= "{{ shared.numberWithCommas( totalObservations ) }}"
    .col-xs-2
      .stat-title= "Species"
      .stat-value.ng-cloak= "{{ shared.numberWithCommas( totalSpecies ) }}"
    .col-xs-2
      .stat-title= "Identifiers"
      .stat-value.ng-cloak= "{{ shared.numberWithCommas( totalIdentifiers ) }}"
    .col-xs-2
      .stat-title= "Observers"
      .stat-value.ng-cloak= "{{ shared.numberWithCommas( totalObservers ) }}"
  #results
    .btn-group
      %button.button.btn-default{ "ng-click": "changeView('map')" }
        %span.glyphicon.glyphicon-map-marker{ "aria-hidden": "true" }
      %button.button.btn-default{ "ng-click": "changeView('grid')" }
        %span.glyphicon.glyphicon-th{ "aria-hidden": "true" }
      %button.button.btn-default{ "ng-click": "changeView('table')" }
        %span.glyphicon.glyphicon-menu-hamburger{ "aria-hidden": "true" }
    %div{ "ng-show": "currentView=='map'", "ng-controller": "MapController"}
      %div{"ng-include": "'ang/templates/observation_search/results_map.html'", "onload": "setupMap()"}
    %div{ "results-grid": true, "ng-show": "currentView=='grid'", "ng-controller": "GridController" }
      %div{"ng-include": "'ang/templates/observation_search/results_grid.html'"}
    %div{ "results-table": true, "ng-show": "currentView=='table'", "ng-controller": "TableController" }
      %div{"ng-include": "'ang/templates/observation_search/results_table.html'"}
