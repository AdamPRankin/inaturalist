:ruby
  listed_taxon ||= taxon_blobs || @listed_taxon
  taxon ||= listed_taxon.taxon || @taxon
  taxon ||= conservation_status.taxon if conservation_status
  conservation_status ||= taxon.threatened_status(:place_id => listed_taxon.place_id) || taxon.threatened_status
  show_place_name ||= false
.upperright
  - if listed_taxon && (listed_taxon.endemic? || listed_taxon.introduced?)
    :ruby
      icon_class = listed_taxon.introduced? ? 'ui-icon-notice' : 'ui-icon-star'
      tip_class = listed_taxon.introduced? ? 'ui-tooltip-error' : 'ui-tooltip-success'
      tip = "<strong>#{listed_taxon.establishment_means.capitalize}"
      tip += " in #{listed_taxon.place.display_name}" if show_place_name && listed_taxon.place
      tip += ":</strong> #{ListedTaxon::ESTABLISHMENT_MEANS_DESCRIPTIONS[listed_taxon.establishment_means]}"
      blob_attrs = {
        :class => "blob #{listed_taxon.introduced? ? 'introduced' : listed_taxon.establishment_means.underscore}", 
        "data-tip" => tip, 
        "data-tip-position-at" => "bottom center", 
        "data-tip-style-classes" => "#{tip_class} ui-tooltip-shadow", 
        :title => listed_taxon.establishment_means.capitalize
      }
    %div{blob_attrs}
      %span{:class => "inlineblock ui-icon #{icon_class}"}
        = listed_taxon.introduced? ? 'I' : listed_taxon.establishment_means.chars.to_a[0].upcase
  - if cs = conservation_status
    :ruby
      tip = "Conservation status: <strong>#{cs.status_name} #{"(#{cs.status})" if cs.status_name != cs.status}</strong>"
      tip += " in #{cs.place.display_name}" if show_place_name && cs.place
      tip += " (#{cs.authority})"
      tip += "<br/>#{cs.description}" unless cs.description.blank?
      blob_attrs = {
        :class => "blob conservation_status #{cs.iucn_status}", 
        "data-tip" => tip, 
        "data-tip-position-at" => "bottom center", 
        "data-tip-style-classes" => "ui-tooltip-#{cs.iucn_status} ui-tooltip-shadow", 
        :title => taxon.conservation_status_name
      }
    %div{blob_attrs}
      %strong= cs.iucn_status_code
