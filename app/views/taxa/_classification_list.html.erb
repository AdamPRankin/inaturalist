<%- 
  taxon ||= classification_list || @taxon || Taxon::LIFE
  ancestors ||= @ancestors || taxon.ancestors
  children ||= @children || taxon.children
  link_method ||= lambda {|t| t.name == "Life" ? taxa_path : taxon_path(t)}
-%>
  
<ul class="taxonomic_tree leafylist">
  <% unless taxon.grafted? -%>
    <li class="unknown">
      <span class="description">
        Still working on classifying this taxon.  Check back later<br/>
        &hellip;
      </span>
    </li>
  <%- else -%>
    <%= render :partial => 'taxa/classification_li', :collection => ancestors, 
      :locals => { :link_method => link_method } %>
  <%- end -%>
  <li class="<%= taxon.iconic_taxon.name if taxon.iconic_taxon %>">
    <strong>
      <%= render :partial => 'shared/taxon', 
                 :locals => {
                   :taxon => taxon, 
                   :include_parens => false, 
                   :link_url => link_method.call(taxon) } %>
    </strong>
    
    <% if taxon.rank == 'species' %>
      <ul id="subspecies" class="details" style="display:none">
        <%= render :partial => 'taxa/classification_li', :collection => children[0..-1], :locals => {
          :link_method => link_method
        } %>
      </ul>
      <span class="button">
        <%= link_to_function "show subspecies", "$(this).parent().siblings('.details').slideDown(); $(this).hide().next().show();" %>
        <%= link_to_function "hide subspecies", "$(this).parent().siblings('.details').slideUp();   $(this).hide().prev().show();", :style => "display:none" %>
      </span>
    <% else %>
      <ul>
        <%= render :partial => 'taxa/classification_li', :collection => children[0..9], :locals => {
          :link_method => link_method
        } %>
      </ul>
          
      <% if children.size > 10 -%>
        <%= link_to_toggle "More...", "#more_children" %>
        <ul id="more_children" style="display:none">
          <%= render :partial => 'taxa/classification_li', :collection => children[10..-1], :locals => {
            :link_method => link_method
          } %>
        </ul>
      <% end -%>
    <% end -%>
  </li>
</ul>
