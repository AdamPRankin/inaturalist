<%- photo ||= change_taxon.photos.first -%>
<%- taxon_range ||= change_taxon.taxon_ranges.first -%>
<%- rendered_taxon_name = capture do -%>
  <%= render(:partial => 'shared/taxon.html.erb', :object => change_taxon) -%>
<%- end -%>

<div id="change_taxon_<%= change_taxon.id %>" class="change_taxon clear <%= change_taxon.iconic_taxon.name rescue 'Unknown' %> taxon-<%= change_taxon.id %>">
  
  <div class="column image">
    <%- if photo -%>
      <%= modal_image(photo) %>
    <% else -%>
      <%= link_to '', change_taxon %>
    <% end -%>
  </div>
  
  <div class="column details">
    <%= link_to rendered_taxon_name, change_taxon %>
    <div class="description">
      <%= link_to change_taxon.observations_count, observations_path(:taxon_id => change_taxon.id) %> Obs
      <%= "|#{change_taxon.conservation_status_code}" unless change_taxon.conservation_status.nil? %>
      <%= "|Range" if taxon_range %>
      <%= change_taxon.is_active ? "|Active" : "|Inactive" %>
    </div>
    <div class="description">
      <span class="small description">
        <% for taxon_scheme in change_taxon.taxon_schemes %>
         <%= taxon_scheme.title  %><br/>
        <% end %>
        <% for swap in change_taxon.taxon_swaps %> 
          <% aka_name = swap.old_taxon.name %>
          <% for aka_scheme in swap.old_taxon.taxon_schemes %>
          <%= link_to "#{aka_scheme.title} (as #{aka_name})", taxon_change_path(swap) %><br/>
          <% end %>
        <% end %>
      </span>
    </div>
  </div>
</div>