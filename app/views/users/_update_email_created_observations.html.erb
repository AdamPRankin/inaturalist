<%-
  user = object || resource
  updates ||= []
  observations = if @update_cache && @update_cache[:observations]
    updates.map{|u| @update_cache[:observations][u.notifier_id]}
  else
    updates.map{|u| u.notifier}
  end
  default_observation = observations.first
  login = user.login
  place_guesses = observations.map{|o| o.place_guess.blank? ? nil : o.place_guess}.compact.uniq
  columns ||= @observation_columns || 6
-%>

<table border="0" cellspacing="0" cellpadding="0">
  <% for obs_group in observations.in_groups_of(columns) %>
    <tr>
      <% for o in obs_group.compact %>
        <td width="75" align="center" valign="top" style="padding-right: 10px; padding-bottom: 10px;">
          <%= link_to observation_image(o, :style => "max-width: 75px; max-height: 75px;"), observation_url(o), :only_path => false %>
          <br/>
          <%= link_to o.species_guess || "Something", observation_url(o), :style => "font-size:smaller;" %>
        </td>
      <% end %>
    </tr>
  <% end %>
</table>
<br/>

<%= link_to "View #{login}'s observations", observations_by_login_url(login) %>
<% unless place_guesses.blank? -%>
  from
  <% place_guesses.each_with_index do |pg, i| %>
    <%= link_to(pg, observations_by_login_url(login, :q => pg, :search_on => "place")) %><%= ',' if i+1 < place_guesses.size %>
  <% end %>
<% end -%>